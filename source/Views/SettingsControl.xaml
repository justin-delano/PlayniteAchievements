<!-- SettingsControl.xaml -->
<UserControl x:Class="PlayniteAchievements.Views.SettingsControl"
             x:Name="SettingsControlRoot"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="clr-namespace:PlayniteAchievements.Views.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="700">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/PlayniteAchievements;component/Resources/RarityIcons.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Disable Steam auth buttons while busy -->
            <Style x:Key="SteamAuthActionButtonStyle"
                   TargetType="Button"
                   BasedOn="{StaticResource {x:Type Button}}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding SteamAuthBusy, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                 Value="True">
                        <Setter Property="IsEnabled" Value="False"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Section header style -->
            <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                <Setter Property="Margin" Value="0,0,0,14"/>
                <Setter Property="Opacity" Value="0.9"/>
            </Style>

            <!-- Accent text style -->
            <Style x:Key="AccentTextStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="{DynamicResource FontSize}"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="Foreground" Value="#4CC9F0"/>
            </Style>

            <!-- Modern button style -->
            <Style x:Key="ModernActionButton" TargetType="Button"
                   BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Padding" Value="18,8"/>
                <Setter Property="MinWidth" Value="120"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Opacity" Value="0.85"/>
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="Opacity" Value="0.7"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Section container style with shadow -->
            <Style x:Key="SectionBorderStyle" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="18"/>
                <Setter Property="Margin" Value="0,0,0,20"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="1"/>
            </Style>

            <!-- Setting row style -->
            <Style x:Key="SettingRowStyle" TargetType="Grid">
                <Setter Property="Margin" Value="0,0,0,14"/>
            </Style>

            <!-- Muted text style -->
            <Style x:Key="MutedTextStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                <Setter Property="Opacity" Value="0.6"/>
                <Setter Property="FontSize" Value="{DynamicResource FontSizeSmall}"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="24,20,24,24">
        <TabControl x:Name="SettingsTabControl" SelectionChanged="TabControl_SelectionChanged" BorderThickness="0">
            <!-- ================== TAB: GENERAL SETTINGS ================== -->
            <TabItem x:Name="GeneralTab" Header="{DynamicResource LOCPlayAch_Settings_TabGeneral}">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="20">

                        <!-- Plugin Header -->
                        <StackPanel Margin="0,0,0,24">
                            <TextBlock Text="{DynamicResource LOCPlayAch_Title_PluginName}"
                                       Foreground="{DynamicResource TextBrush}"
                                       Style="{DynamicResource BaseTextBlockStyle}"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,6" />
                            <TextBlock Text="{DynamicResource LOCPlayAch_Settings_Description}"
                                       Style="{DynamicResource MutedTextStyle}"
                                       Margin="0,0,0,8"/>
                            <!-- Decorative accent line -->
                            <Border Height="2"
                                    Width="60"
                                    HorizontalAlignment="Left"
                                    Background="#4CC9F0"
                                    CornerRadius="1"
                                    Margin="0,8,0,0"/>
                        </StackPanel>

                        <!-- ================== RARITY THRESHOLDS ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_Section_RarityThresholds}"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           Margin="0,0,0,12"/>

                                <TextBlock Style="{StaticResource MutedTextStyle}"
                                           Margin="0,0,0,16">
                                    Configure the global unlock percentage cutoffs that determine achievement rarity tiers.
                                    Achievements are categorized based on what percentage of players have unlocked them.
                                </TextBlock>

                                <!-- Threshold settings grid -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Ultra Rare -->
                                    <Border Grid.Row="0" Grid.Column="0"
                                            Background="#22E91E63"
                                            CornerRadius="8"
                                            Padding="14"
                                            Margin="0,0,8,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Grid.Column="0"
                                                   Source="{StaticResource BadgePlatinumHexagon}"
                                                   Width="28" Height="28"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"
                                                   Effect="{StaticResource BadgeShadow}"/>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Rarity_UltraRare}"
                                                           FontWeight="SemiBold"
                                                           Foreground="#E91E63"
                                                           Margin="0,0,0,2"/>
                                                <TextBlock Text="{DynamicResource LOCPlayAch_RarityThreshold_LTE}"
                                                           Style="{StaticResource MutedTextStyle}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBox Text="{Binding Persisted.UltraRareThreshold, UpdateSourceTrigger=PropertyChanged, StringFormat=F1}"
                                                         Width="50"
                                                         TextAlignment="Right"
                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="%"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Rare -->
                                    <Border Grid.Row="0" Grid.Column="1"
                                            Background="#22FF9800"
                                            CornerRadius="8"
                                            Padding="14"
                                            Margin="8,0,0,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Grid.Column="0"
                                                   Source="{StaticResource BadgeGoldPentagon}"
                                                   Width="28" Height="28"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"
                                                   Effect="{StaticResource BadgeShadow}"/>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Rarity_Rare}"
                                                           FontWeight="SemiBold"
                                                           Foreground="#FF9800"
                                                           Margin="0,0,0,2"/>
                                                <TextBlock Text="{DynamicResource LOCPlayAch_RarityThreshold_LTE}"
                                                           Style="{StaticResource MutedTextStyle}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBox Text="{Binding Persisted.RareThreshold, UpdateSourceTrigger=PropertyChanged, StringFormat=F1}"
                                                         Width="50"
                                                         TextAlignment="Right"
                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="%"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Uncommon -->
                                    <Border Grid.Row="1" Grid.Column="0"
                                            Background="#2203A9F4"
                                            CornerRadius="8"
                                            Padding="14"
                                            Margin="0,0,8,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Grid.Column="0"
                                                   Source="{StaticResource BadgeSilverSquare}"
                                                   Width="28" Height="28"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"
                                                   Effect="{StaticResource BadgeShadow}"/>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Rarity_Uncommon}"
                                                           FontWeight="SemiBold"
                                                           Foreground="#03A9F4"
                                                           Margin="0,0,0,2"/>
                                                <TextBlock Text="{DynamicResource LOCPlayAch_RarityThreshold_LTE}"
                                                           Style="{StaticResource MutedTextStyle}"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                                <TextBox Text="{Binding Persisted.UncommonThreshold, UpdateSourceTrigger=PropertyChanged, StringFormat=F1}"
                                                         Width="50"
                                                         TextAlignment="Right"
                                                         VerticalAlignment="Center"/>
                                                <TextBlock Text="%"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Common -->
                                    <Border Grid.Row="1" Grid.Column="1"
                                            Background="#228BC34A"
                                            CornerRadius="8"
                                            Padding="14"
                                            Margin="8,0,0,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Grid.Column="0"
                                                   Source="{StaticResource BadgeBronzeTriangle}"
                                                   Width="28" Height="28"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"
                                                   Effect="{StaticResource BadgeShadow}"/>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Rarity_Common}"
                                                           FontWeight="SemiBold"
                                                           Foreground="#8BC34A"
                                                           Margin="0,0,0,2"/>
                                                <TextBlock Text="{DynamicResource LOCPlayAch_RarityThreshold_GT}"
                                                           Style="{StaticResource MutedTextStyle}"/>
                                            </StackPanel>
                                            <TextBlock Grid.Column="2"
                                                       Text="—"
                                                       Foreground="{DynamicResource TextBrush}"
                                                       Opacity="0.4"
                                                       VerticalAlignment="Center"
                                                       />
                                        </Grid>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- ================== SYNC & UPDATES ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_Section_SyncUpdates}"
                                           Style="{StaticResource SectionHeaderStyle}"/>

                                <!-- Periodic Updates -->
                                <Grid Style="{StaticResource SettingRowStyle}" Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                            <CheckBox Content="{DynamicResource LOCPlayAch_Settings_EnablePeriodicUpdates}"
                                                          IsChecked="{Binding Persisted.EnablePeriodicUpdates}"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <TextBlock Text="{DynamicResource LOCPlayAch_Settings_HoursBetweenUpdates}"
                                                   Foreground="{DynamicResource TextBrush}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                            <TextBox Text="{Binding Persisted.PeriodicUpdateHours, UpdateSourceTrigger=PropertyChanged}"
                                                 Width="50"
                                                     IsEnabled="{Binding Persisted.EnablePeriodicUpdates}"
                                                 TextAlignment="Right"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Quick Refresh -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{DynamicResource LOCPlayAch_Settings_QuickRefresh_Title}"
                                                   Foreground="{DynamicResource TextBrush}"
                                                   FontWeight="SemiBold"
                                                   Margin="0,0,0,2"/>
                                        <TextBlock Text="{DynamicResource LOCPlayAch_Settings_QuickRefresh_Description}"
                                                   Style="{StaticResource MutedTextStyle}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="{DynamicResource LOCPlayAch_Settings_QuickRefresh_RecentGames}"
                                                   Foreground="{DynamicResource TextBrush}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                            <TextBox Text="{Binding Persisted.QuickRefreshRecentGamesCount, UpdateSourceTrigger=PropertyChanged}"
                                                 Width="50"
                                                 TextAlignment="Right"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Ignore Unplayed Games -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                            <CheckBox Content="{DynamicResource LOCPlayAch_IgnoreUnplayedGames}"
                                                          IsChecked="{Binding Persisted.IgnoreUnplayedGames}"
                                                  VerticalAlignment="Center"/>
                                        <TextBlock Text="{DynamicResource LOCPlayAch_IgnoreUnplayedGames_Help}"
                                                   Style="{StaticResource MutedTextStyle}"
                                                   Margin="20,4,0,0"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- ================== NOTIFICATIONS ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_Section_Notifications}"
                                           Style="{StaticResource SectionHeaderStyle}"/>

                                <StackPanel>
                                        <CheckBox Content="{DynamicResource LOCPlayAch_Settings_EnableNotifications}"
                                                  IsChecked="{Binding Persisted.EnableNotifications}"
                                              Margin="0,0,0,10"/>
                                    <CheckBox Content="{DynamicResource LOCPlayAch_Settings_NotifyPeriodicUpdates}"
                                                  IsChecked="{Binding Persisted.NotifyPeriodicUpdates}"
                                              Margin="18,0,0,10"
                                                  IsEnabled="{Binding Persisted.EnableNotifications}"/>
                                    <CheckBox Content="{DynamicResource LOCPlayAch_Settings_NotifyOnRebuild}"
                                                  IsChecked="{Binding Persisted.NotifyOnRebuild}"
                                              Margin="18,0,0,0"
                                                  IsEnabled="{Binding Persisted.EnableNotifications}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- ================== APPEARANCE ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_Settings_Appearance}"
                                           Style="{StaticResource SectionHeaderStyle}"/>

                                <!-- Checkboxes -->
                                <StackPanel>
                                        <CheckBox Content="{DynamicResource LOCPlayAch_Settings_HideLocked}"
                                                  IsChecked="{Binding Persisted.HideAchievementsLockedForSelf}"
                                              Margin="0,0,0,10"/>
                                    <CheckBox Content="{DynamicResource LOCPlayAch_UseCoverImages}"
                                                  IsChecked="{Binding Persisted.UseCoverImages}"
                                              Margin="0,0,0,10"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- ================== THEME INTEGRATION ================== -->
                        <!-- <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Theme Integration"
                                           Style="{StaticResource SectionHeaderStyle}"/>

                                <TextBlock Style="{StaticResource MutedTextStyle}"
                                           Margin="0,0,0,16">
                                    PlayniteAchievements is the single source for both Desktop and Fullscreen themes.
                                    Both native and SuccessStory-compatible properties are always populated so themes can bind to either surface.
                                </TextBlock>

                                 <Separator Margin="0,16,0,16" />

                                <TextBlock Text="Native PlayniteAchievements theme integration"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8" />

                                <TextBlock Style="{StaticResource MutedTextStyle}"
                                           Margin="0,0,0,0">
                                    Native controls and properties (prefixed differently) are always available to themes.
                                    Theme authors should use the native PlayniteAchievements prefix for new themes.
                                </TextBlock>
                            </StackPanel>
                        </Border> -->

                        <!-- ================== DATA MANAGEMENT ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_Settings_Cache_Title}"
                                           Style="{StaticResource SectionHeaderStyle}"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Settings_Cache_Description}"
                                               Style="{StaticResource MutedTextStyle}"
                                               VerticalAlignment="Center"/>

                                    <Button Grid.Row="0" Grid.Column="1"
                                            Content="{DynamicResource LOCPlayAch_Settings_WipeCache_All}"
                                            Click="WipeCache_Click"
                                            Padding="14,6"
                                            Margin="16,0,0,0"
                                            MinWidth="90"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Settings_ImageCache_Description}"
                                               Style="{StaticResource MutedTextStyle}"
                                               Margin="0,10,0,0"
                                               VerticalAlignment="Top"/>

                                    <Button Grid.Row="1" Grid.Column="1"
                                            Content="{DynamicResource LOCPlayAch_Settings_ImageCache_Clear}"
                                            Click="ClearImageCache_Click"
                                            Padding="14,6"
                                            Margin="16,10,0,0"
                                            MinWidth="90"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Settings_ResetFirstTimeSetup}"
                                               Style="{StaticResource MutedTextStyle}"
                                               Margin="0,10,0,0"
                                               VerticalAlignment="Top"/>

                                    <Button Grid.Row="2" Grid.Column="1"
                                            Content="{DynamicResource LOCPlayAch_Settings_ResetFirstTimeSetupButton}"
                                            Click="ResetFirstTimeSetup_Click"
                                            Padding="14,6"
                                            Margin="16,10,0,0"
                                            MinWidth="90"/>

                                    <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                              Content="{DynamicResource LOCPlayAch_Settings_EnableDiagnostics}"
                                              IsChecked="{Binding Persisted.EnableDiagnostics}"
                                              Margin="0,10,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ================== TAB: STEAM SETTINGS ================== -->
            <TabItem x:Name="SteamTab" Header="{DynamicResource LOCPlayAch_Provider_Steam}">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="20">

                        <!-- ================== STEAM CONNECTION ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <!-- Steam Language (moved to top) -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Settings_SteamLanguage}"
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Center"/>

                                        <ComboBox Grid.Column="1"
                                                  SelectedValue="{Binding Persisted.SteamLanguage}"
                                              SelectedValuePath="Tag"
                                              VerticalAlignment="Center"
                                              MinWidth="150"
                                              HorizontalAlignment="Left">
                                        <ComboBoxItem Content="English" Tag="english"/>
                                        <ComboBoxItem Content="German (Deutsch)" Tag="german"/>
                                        <ComboBoxItem Content="French (Français)" Tag="french"/>
                                        <ComboBoxItem Content="Spanish (Español)" Tag="spanish"/>
                                        <ComboBoxItem Content="Italian (Italiano)" Tag="italian"/>
                                        <ComboBoxItem Content="Portuguese" Tag="portuguese"/>
                                        <ComboBoxItem Content="Brazilian Portuguese" Tag="brazilian"/>
                                        <ComboBoxItem Content="Russian (Русский)" Tag="russian"/>
                                        <ComboBoxItem Content="Polish (Polski)" Tag="polish"/>
                                        <ComboBoxItem Content="Dutch (Nederlands)" Tag="dutch"/>
                                        <ComboBoxItem Content="Swedish (Svenska)" Tag="swedish"/>
                                        <ComboBoxItem Content="Finnish (Suomi)" Tag="finnish"/>
                                        <ComboBoxItem Content="Danish (Dansk)" Tag="danish"/>
                                        <ComboBoxItem Content="Norwegian (Norsk)" Tag="norwegian"/>
                                        <ComboBoxItem Content="Hungarian (Magyar)" Tag="hungarian"/>
                                        <ComboBoxItem Content="Czech (Čeština)" Tag="czech"/>
                                        <ComboBoxItem Content="Romanian (Română)" Tag="romanian"/>
                                        <ComboBoxItem Content="Turkish (Türkçe)" Tag="turkish"/>
                                        <ComboBoxItem Content="Greek (Ελληνικά)" Tag="greek"/>
                                        <ComboBoxItem Content="Bulgarian (Български)" Tag="bulgarian"/>
                                        <ComboBoxItem Content="Ukrainian (Українська)" Tag="ukrainian"/>
                                        <ComboBoxItem Content="Thai (ไทย)" Tag="thai"/>
                                        <ComboBoxItem Content="Vietnamese (Tiếng Việt)" Tag="vietnamese"/>
                                        <ComboBoxItem Content="Japanese (日本語)" Tag="japanese"/>
                                        <ComboBoxItem Content="Korean (한국어)" Tag="koreana"/>
                                        <ComboBoxItem Content="Simplified Chinese (简体中文)" Tag="schinese"/>
                                        <ComboBoxItem Content="Traditional Chinese (繁體中文)" Tag="tchinese"/>
                                        <ComboBoxItem Content="Arabic (العربية)" Tag="arabic"/>
                                    </ComboBox>
                                </Grid>

                                <!-- Steam Authentication (unified box for API key + web auth) -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Label_SteamAuth}"
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Top"
                                               Margin="0,8,0,0"/>

                                    <!-- Unified Auth Card (green if BOTH api key + web auth, red otherwise) -->
                                    <Border Grid.Column="1"
                                            Background="{DynamicResource PanelBackgroundBrush}"
                                            CornerRadius="8"
                                            Padding="16"
                                            BorderThickness="1">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderBrush" Value="#F72585"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SteamFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                 Value="True">
                                                        <Setter Property="BorderBrush" Value="#06FFA5"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>

                                        <StackPanel>
                                            <!-- Web Auth Section -->
                                            <StackPanel Margin="0,0,0,14">
                                                <!-- Section Label -->
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Settings_SteamWebAuth}"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           FontSize="{DynamicResource FontSizeSmall}"
                                                           FontWeight="SemiBold"
                                                           Opacity="0.8"
                                                           Margin="0,0,0,8"/>

                                                <!-- Status Row -->
                                                <Grid Margin="0,0,0,10">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Status Icon -->
                                                    <TextBlock Grid.Column="0"
                                                               FontFamily="Segoe MDL2 Assets"
                                                               FontSize="{DynamicResource FontSize}"
                                                               Margin="0,0,12,0"
                                                               VerticalAlignment="Center">
                                                        <TextBlock.RenderTransform>
                                                            <ScaleTransform ScaleX="1.5" ScaleY="1.5"/>
                                                        </TextBlock.RenderTransform>
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SteamFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                                 Value="True">
                                                                        <Setter Property="Text" Value="&#xE73E;"/>
                                                                        <Setter Property="Foreground" Value="#06FFA5"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SteamFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                                 Value="False">
                                                                        <Setter Property="Text" Value="&#xE711;"/>
                                                                        <Setter Property="Foreground" Value="#F72585"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <!-- Status Text -->
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding SteamAuthStatus, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                               Foreground="{DynamicResource TextBrush}"
                                                               TextWrapping="Wrap"
                                                               VerticalAlignment="Center"
                                                               FontSize="{DynamicResource FontSize}"
                                                               FontWeight="SemiBold"/>
                                                </Grid>

                                                <!-- Buttons Row (left-aligned) -->
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content="{DynamicResource LOCPlayAch_Settings_CheckSteamAuth}"
                                                            Style="{StaticResource SteamAuthActionButtonStyle}"
                                                            Click="SteamAuth_Check_Click"
                                                            Padding="14,6"
                                                            Margin="0,0,8,0"/>
                                                    <Button Content="{DynamicResource LOCPlayAch_Settings_ReauthSteam}"
                                                            Style="{StaticResource SteamAuthActionButtonStyle}"
                                                            Click="SteamAuth_Authenticate_Click"
                                                            Padding="14,6"
                                                            Margin="0,0,8,0"/>
                                                    <Button Content="{DynamicResource LOCPlayAch_Button_Clear}"
                                                            ToolTip="{DynamicResource LOCPlayAch_Tooltip_Clear}"
                                                            Style="{StaticResource SteamAuthActionButtonStyle}"
                                                            Click="SteamAuth_Clear_Click"
                                                            Padding="14,6"/>
                                                </StackPanel>

                                                <!-- Progress bar under buttons -->
                                                <ProgressBar Height="3"
                                                             Margin="0,8,0,0"
                                                             IsIndeterminate="True"
                                                             Foreground="#06FFA5">
                                                    <ProgressBar.Style>
                                                        <Style TargetType="ProgressBar">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding SteamAuthBusy, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                             Value="True">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ProgressBar.Style>
                                                </ProgressBar>
                                            </StackPanel>

                                            <!-- Separator -->
                                            <Border Height="1"
                                                    Background="{DynamicResource ControlBorderBrush}"
                                                    Opacity="0.5"
                                                    Margin="0,0,0,14"/>

                                            <!-- API Key Section -->
                                            <StackPanel>
                                                <TextBlock Text="{DynamicResource LOCPlayAch_Settings_SteamApiKey}"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           Margin="0,0,0,6"/>

                                                <TextBox Text="{Binding Persisted.SteamApiKey, UpdateSourceTrigger=PropertyChanged}"
                                                         KeyDown="SteamApiKey_KeyDown"
                                                         Margin="0,0,0,6"/>

                                                <TextBlock Style="{StaticResource MutedTextStyle}">
                                                    <Run Text="{DynamicResource LOCPlayAch_Settings_SteamApiKeyHint}" />
                                                    <Run Text=" " />
                                                    <Hyperlink NavigateUri="https://steamcommunity.com/dev/apikey"
                                                               RequestNavigate="Hyperlink_RequestNavigate">
                                                        <Run Text="steamcommunity.com/dev/apikey" />
                                                    </Hyperlink>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <!-- Steam User ID (at bottom, read-only tint) -->
                                <Border Background="#10000000"
                                        CornerRadius="6"
                                        Padding="12"
                                        Margin="0,0,0,0">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="168"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0"
                                                   Text="{DynamicResource LOCPlayAch_Label_SteamUserId}"
                                                   Foreground="{DynamicResource TextBrush}"
                                                   VerticalAlignment="Center"
                                                   Opacity="0.7"/>

                                            <TextBox Grid.Row="0" Grid.Column="1"
                                                     Text="{Binding Persisted.SteamUserId, UpdateSourceTrigger=PropertyChanged}"
                                                 IsReadOnly="True"
                                                 VerticalAlignment="Center"
                                                 BorderThickness="0"
                                                 Background="Transparent"
                                                 Foreground="{DynamicResource TextBrush}"
                                                 Opacity="0.6"/>

                                        <TextBlock Grid.Row="1" Grid.Column="1"
                                                   Margin="0,6,0,0"
                                                   Style="{StaticResource MutedTextStyle}"
                                                   Opacity="0.5">
                                            <Run Text="{DynamicResource LOCPlayAch_Label_SteamUserId_Help}" />
                                        </TextBlock>
                                    </Grid>
                                </Border>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ================== TAB: RETROACHIEVEMENTS SETTINGS ================== -->
            <TabItem x:Name="RetroAchievementsTab" Header="{DynamicResource LOCPlayAch_Provider_RetroAchievements}">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="20">
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <!-- RetroAchievements Authentication (unified box) -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{DynamicResource LOCPlayAch_Label_RaAuth}"
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Top"
                                               Margin="0,8,0,0"
                                               TextWrapping="Wrap"/>

                                    <!-- Unified Auth Card (green if BOTH username + API key, red otherwise) -->
                                    <Border Grid.Column="1"
                                            Background="{DynamicResource PanelBackgroundBrush}"
                                            CornerRadius="8"
                                            Padding="16"
                                            BorderThickness="1">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderBrush" Value="#F72585"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RaFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                 Value="True">
                                                        <Setter Property="BorderBrush" Value="#06FFA5"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>

                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Status Row -->
                                            <Grid Grid.Row="0" Margin="0,0,0,14">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Status Icon -->
                                                <TextBlock Grid.Column="0"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="{DynamicResource FontSize}"
                                                           Margin="0,0,12,0"
                                                           VerticalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding RaFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                             Value="True">
                                                                    <Setter Property="Text" Value="&#xE73E;"/>
                                                                    <Setter Property="Foreground" Value="#06FFA5"/>
                                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding RaFullyConfigured, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                             Value="False">
                                                                    <Setter Property="Text" Value="&#xE711;"/>
                                                                    <Setter Property="Foreground" Value="#F72585"/>
                                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <TextBlock.RenderTransform>
                                                        <ScaleTransform ScaleX="1.5" ScaleY="1.5"/>
                                                    </TextBlock.RenderTransform>
                                                </TextBlock>

                                                <!-- Status Text -->
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding RaAuthStatus, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           TextWrapping="Wrap"
                                                           VerticalAlignment="Center"
                                                           FontSize="{DynamicResource FontSize}"
                                                           FontWeight="SemiBold"/>
                                            </Grid>

                                            <!-- Separator -->
                                            <Border Grid.Row="0" Height="1"
                                                    Background="{DynamicResource ControlBorderBrush}"
                                                    Opacity="0.5"
                                                    Margin="36,0,0,14"/>

                                            <!-- Credentials Section -->
                                            <StackPanel Grid.Row="1">
                                                <!-- Username -->
                                                <StackPanel Margin="0,0,0,12">
                                                    <TextBlock Text="{DynamicResource LOCPlayAch_Label_Username}"
                                                               Foreground="{DynamicResource TextBrush}"
                                                               FontSize="{DynamicResource FontSizeSmall}"
                                                               Opacity="0.8"
                                                               Margin="0,0,0,4"/>
                                                    <TextBox Text="{Binding Persisted.RaUsername, UpdateSourceTrigger=PropertyChanged}"
                                                             KeyDown="RaUsername_KeyDown"
                                                             Margin="0,0,0,4"/>
                                                    <TextBlock Style="{StaticResource MutedTextStyle}">
                                                        <Run Text="{DynamicResource LOCPlayAch_Label_Username_Help}" />
                                                    </TextBlock>
                                                </StackPanel>

                                                <!-- API Key -->
                                                <StackPanel>
                                                    <TextBlock Text="{DynamicResource LOCPlayAch_Label_WebApiKey}"
                                                               Foreground="{DynamicResource TextBrush}"
                                                               FontSize="{DynamicResource FontSizeSmall}"
                                                               Opacity="0.8"
                                                               Margin="0,0,0,4"/>
                                                    <TextBox Text="{Binding Persisted.RaWebApiKey, UpdateSourceTrigger=PropertyChanged}"
                                                             KeyDown="RaApiKey_KeyDown"
                                                             Margin="0,0,0,4"/>
                                                    <TextBlock Style="{StaticResource MutedTextStyle}">
                                                        <Run Text="{DynamicResource LOCPlayAch_Label_WebApiKey_Help}" />
                                                        <Run Text=" " />
                                                        <Hyperlink NavigateUri="https://retroachievements.org/controlpanel.php"
                                                                   RequestNavigate="Hyperlink_RequestNavigate">
                                                            <Run Text="retroachievements.org/controlpanel.php" />
                                                        </Hyperlink>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </Grid>

                                <!-- RetroAchievements Rarity Stats -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="Rarity stats"
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Center"/>

                                        <ComboBox Grid.Row="0" Grid.Column="1"
                                                  SelectedValue="{Binding Persisted.RaRarityStats}"
                                              SelectedValuePath="Tag"
                                              VerticalAlignment="Center"
                                              MinWidth="160"
                                              HorizontalAlignment="Left">
                                        <ComboBoxItem Content="Casual (Softcore)" Tag="casual"/>
                                        <ComboBoxItem Content="Hardcore" Tag="hardcore"/>
                                        <ComboBoxItem Content="Overall (Casual + Hardcore)" Tag="combined"/>
                                    </ComboBox>

                                    <TextBlock Grid.Row="1" Grid.Column="1"
                                               Margin="0,6,0,0"
                                               Style="{StaticResource MutedTextStyle}">
                                        <Run Text="Controls how rarity percentages are calculated. Changing this requires a rescan to update cached values." />
                                    </TextBlock>
                                </Grid>

                                 <!-- Scanning options -->
                                 <TextBlock Text="Scanning &amp; Hashing"
                                            Style="{StaticResource SectionHeaderStyle}"
                                            Margin="0,8,0,12"/>

                                <StackPanel>
                                        <CheckBox Content="Enable archive scanning (.zip/.7z)"
                                                  IsChecked="{Binding Persisted.EnableArchiveScanning}"
                                              Margin="0,0,0,10"/>
                                    <CheckBox Content="Enable disc hashing (for disc-based consoles)"
                                                  IsChecked="{Binding Persisted.EnableDiscHashing}"
                                              Margin="0,0,0,10"/>
                                </StackPanel>

                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="Hash index max age (days)"
                                               Foreground="{DynamicResource TextBrush}"
                                               VerticalAlignment="Center"/>

                                        <TextBox Grid.Column="1"
                                                 Text="{Binding Persisted.HashIndexMaxAgeDays, UpdateSourceTrigger=PropertyChanged}"
                                             Width="60"
                                             TextAlignment="Right"
                                             VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- ================== TAB: THEME MIGRATION ================== -->
            <TabItem x:Name="ThemeMigrationTab" Header="{DynamicResource LOCPlayAch_ThemeMigration_Title}">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="20">

                        <!-- Plugin Header -->
                        <StackPanel Margin="0,0,0,24">
                            <TextBlock Text="{DynamicResource LOCPlayAch_ThemeMigration_Title}"
                                       Foreground="{DynamicResource TextBrush}"
                                       Style="{DynamicResource BaseTextBlockStyle}"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,6" />
                            <TextBlock Text="{DynamicResource LOCPlayAch_ThemeMigration_Description}"
                                       Style="{DynamicResource MutedTextStyle}"
                                       Margin="0,0,0,8"/>
                            <!-- Decorative accent line -->
                            <Border Height="2"
                                    Width="60"
                                    HorizontalAlignment="Left"
                                    Background="#4CC9F0"
                                    CornerRadius="1"
                                    Margin="0,8,0,0"/>
                        </StackPanel>

                        <!-- ================== TRANSITION SECTION ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource LOCPlayAch_ThemeMigration_Transition}"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           Margin="0,0,0,12"/>

                                <TextBlock Style="{StaticResource MutedTextStyle}"
                                           Margin="0,0,0,16">
                                    Transition a theme from SuccessStory to PlayniteAchievements.
                                    A backup will be created before any modifications are made.
                                </TextBlock>

                                <!-- Theme Dropdown and Transition Button -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox Grid.Column="0"
                                              ItemsSource="{Binding AvailableThemes, ElementName=SettingsControlRoot}"
                                              DisplayMemberPath="Name"
                                              SelectedValuePath="Path"
                                              SelectedValue="{Binding SelectedThemePath, ElementName=SettingsControlRoot}"
                                              VerticalContentAlignment="Center"
                                              IsEnabled="{Binding HasThemesToTransition, ElementName=SettingsControlRoot}"/>

                                    <Button Grid.Column="1"
                                            Content="{DynamicResource LOCPlayAch_ThemeMigration_Transition}"
                                            Click="TransitionTheme_Click"
                                            Padding="14,6"
                                            Margin="16,0,0,0"
                                            MinWidth="100"
                                            IsEnabled="{Binding HasThemesToTransition, ElementName=SettingsControlRoot}"/>
                                </Grid>

                                <!-- No themes message -->
                                <TextBlock Text="{DynamicResource LOCPlayAch_ThemeMigration_NoThemesMessage}"
                                           Style="{StaticResource MutedTextStyle}"
                                           Margin="0,8,0,0"
                                           Visibility="{Binding ShowNoThemesMessage, ElementName=SettingsControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </StackPanel>
                        </Border>

                        <!-- ================== REVERT SECTION ================== -->
                        <Border Style="{StaticResource SectionBorderStyle}">
                            <StackPanel>
                                <TextBlock Text="Revert Theme"
                                           Style="{StaticResource SectionHeaderStyle}"
                                           Margin="0,0,0,12"/>

                                <TextBlock Style="{StaticResource MutedTextStyle}"
                                           Margin="0,0,0,16">
                                    Restore a previously transitioned theme from its backup.
                                    The backup folder will be preserved after reverting.
                                </TextBlock>

                                <!-- Revertable Theme Dropdown and Revert Button -->
                                <Grid Style="{StaticResource SettingRowStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox Grid.Column="0"
                                              ItemsSource="{Binding RevertableThemes, ElementName=SettingsControlRoot}"
                                              DisplayMemberPath="Name"
                                              SelectedValuePath="Path"
                                              SelectedValue="{Binding SelectedRevertThemePath, ElementName=SettingsControlRoot}"
                                              VerticalContentAlignment="Center"
                                              IsEnabled="{Binding HasRevertableThemes, ElementName=SettingsControlRoot}"/>

                                    <Button Grid.Column="1"
                                            Content="Revert"
                                            Click="RevertTheme_Click"
                                            Padding="14,6"
                                            Margin="16,0,0,0"
                                            MinWidth="100"
                                            IsEnabled="{Binding HasRevertableThemes, ElementName=SettingsControlRoot}"/>
                                </Grid>

                                <!-- No revertable themes message -->
                                <TextBlock Text="No themes found with backups that can be reverted."
                                           Style="{StaticResource MutedTextStyle}"
                                           Margin="0,8,0,0"
                                           Visibility="{Binding ShowNoRevertableThemesMessage, ElementName=SettingsControlRoot, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
