<local:SuccessStoryThemeControlBase x:Class="PlayniteAchievements.Views.ThemeIntegration.SuccessStory.SuccessStoryPluginCompactListControl"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                   xmlns:controls="clr-namespace:Playnite.SDK.Controls;assembly=Playnite.SDK"
                   xmlns:converters="clr-namespace:PlayniteAchievements.Views.Converters"
                   xmlns:local="clr-namespace:PlayniteAchievements.Views.ThemeIntegration.Base"
                   xmlns:localSuccessStory="clr-namespace:PlayniteAchievements.Views.ThemeIntegration.SuccessStory"
                   xmlns:localControls="clr-namespace:PlayniteAchievements.Views.ThemeIntegration.SuccessStory.Controls"
                   mc:Ignorable="d"
                   d:DesignHeight="100" d:DesignWidth="300">
    <!--
        SuccessStory-compatible compact list control.
        Matches the original SuccessStory plugin styling.
        Displays achievement icons in a horizontal wrap panel.
    -->
    <local:SuccessStoryThemeControlBase.Resources>
        <converters:BooleanConverter x:Key="BooleanToVisibilityConverter" Mode="ToVisibility" />
        <converters:BooleanConverter x:Key="InverseBoolToVisConverter" Mode="InvertedToVisibility" />
        <converters:BooleanConverter x:Key="InvertBoolConverter" Mode="Inverted" />
    </local:SuccessStoryThemeControlBase.Resources>

    <Grid Name="PART_GridContener" Tag="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=IconHeight}">
        <ListBox ItemsSource="{Binding SuccessStoryTheme.ListAchievements, Mode=OneWay}"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 ScrollViewer.VerticalScrollBarVisibility="Disabled"
                 ScrollViewer.CanContentScroll="True"
                 ScrollViewer.PanningMode="HorizontalOnly"
                 VirtualizingPanel.IsVirtualizing="True"
                 VirtualizingPanel.VirtualizationMode="Recycling"
                 HorizontalContentAlignment="Left">
            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                <Grid>
                                    <Border Padding="{TemplateBinding Padding}" Background="Transparent">
                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                          Margin="3,0,0,0" />
                                    </Border>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListBox.ItemContainerStyle>

            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <!-- One horizontal row that scrolls. -->
                    <VirtualizingStackPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid HorizontalAlignment="Left">
                        <StackPanel ToolTip="{Binding DisplayName}" Margin="4" HorizontalAlignment="Left">
                            <StackPanel.Style>
                                <Style TargetType="{x:Type StackPanel}">
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=ShowHiddenIcon}" Value="False" />
                                                <Condition Binding="{Binding Hidden}" Value="True" />
                                                <Condition Binding="{Binding Unlocked}" Value="False" />
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Effect">
                                                <Setter.Value>
                                                    <BlurEffect Radius="4.0" KernelType="Box" />
                                                </Setter.Value>
                                            </Setter>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <localControls:AchievementImage
                                Margin="4"
                                Width="{Binding ElementName=PART_GridContener, Path=Tag}"
                                Height="{Binding ElementName=PART_GridContener, Path=Tag}"
                                Icon="{Binding UnlockedIconDisplay, IsAsync=True}"
                                IconCustom="{Binding LockedIconDisplay, IsAsync=True}"
                                IsLocked="{Binding Unlocked, Converter={StaticResource InvertBoolConverter}}"
                                Percent="{Binding GlobalPercentUnlocked}"
                                EnableRaretyIndicator="True"
                                DisplayRaretyValue="False" />
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</local:SuccessStoryThemeControlBase>
